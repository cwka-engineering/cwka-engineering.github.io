---
layout: default
title: Search
permalink: /search.html
---

# Search the Wiki

<div id="search-container">
  <input type="text" id="search-input" placeholder="Type to search... (e.g., 'Epicor', 'BOM', 'shipping components')" autofocus>
  <div id="results-info"></div>
  <ul id="results-container"></ul>
</div>

<script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"></script>
<script>
  // Build search index from all pages
  window.store = {};
  window.pages = [
    {% for page in site.pages %}
      {% if page.title and page.permalink != '/search.html' and page.permalink != '/' %}
        {
          "title": {{ page.title | jsonify }},
          "url": "{{ page.url | relative_url }}",
          "content": {{ page.content | strip_html | strip_newlines | replace: '"', '&quot;' | jsonify }}
        }{% unless forloop.last %},{% endunless %}
      {% endif %}
    {% endfor %}
  ];

  // Create store object
  window.pages.forEach(function(page) {
    window.store[page.url] = page;
  });

  // Build Lunr search index
  const idx = lunr(function () {
    this.ref('url');
    this.field('title', { boost: 10 });
    this.field('content', { boost: 1 });

    window.pages.forEach(function(page) {
      this.add({
        url: page.url,
        title: page.title,
        content: page.content
      });
    });
  });

  // Search function
  function search(query) {
    if (!query || query.trim().length < 2) {
      return [];
    }

    try {
      const results = idx.search(query);
      return results.map(result => {
        return window.store[result.ref];
      });
    } catch (e) {
      console.error('Search error:', e);
      return [];
    }
  }

  // Highlight search terms in text
  function highlightText(text, query) {
    if (!query) return text;
    const terms = query.toLowerCase().split(/\s+/);
    let highlighted = text;
    terms.forEach(term => {
      if (term.length > 1) {
        const regex = new RegExp(`(${term})`, 'gi');
        highlighted = highlighted.replace(regex, '<mark>$1</mark>');
      }
    });
    return highlighted;
  }

  // Display results
  function displayResults(results, query) {
    const resultsContainer = document.getElementById('results-container');
    const resultsInfo = document.getElementById('results-info');
    
    if (!query || query.trim().length < 2) {
      resultsContainer.innerHTML = '';
      resultsInfo.innerHTML = '<p>Type at least 2 characters to search.</p>';
      return;
    }

    if (results.length === 0) {
      resultsContainer.innerHTML = '';
      resultsInfo.innerHTML = '<p>No results found for "<strong>' + query + '</strong>". Try different keywords or check spelling.</p>';
      return;
    }

    resultsInfo.innerHTML = '<p>Found <strong>' + results.length + '</strong> result' + (results.length === 1 ? '' : 's') + ' for "<strong>' + query + '</strong>":</p>';

    resultsContainer.innerHTML = results.map(result => {
      // Find the best matching excerpt
      const content = result.content || '';
      const queryLower = query.toLowerCase();
      const queryTerms = queryLower.split(/\s+/).filter(t => t.length > 1);
      
      let excerpt = '';
      let excerptStart = 0;
      
      if (queryTerms.length > 0) {
        // Find first occurrence of any search term
        const firstTerm = queryTerms[0];
        const firstIndex = content.toLowerCase().indexOf(firstTerm);
        
        if (firstIndex !== -1) {
          excerptStart = Math.max(0, firstIndex - 100);
          excerpt = content.substring(excerptStart, firstIndex + 200);
        } else {
          excerpt = content.substring(0, 300);
        }
      } else {
        excerpt = content.substring(0, 300);
      }
      
      if (excerpt.length < content.length) {
        excerpt = '...' + excerpt + '...';
      }
      
      const highlightedExcerpt = highlightText(excerpt, query);
      const highlightedTitle = highlightText(result.title, query);
      
      return `
        <li>
          <h3><a href="${result.url}">${highlightedTitle}</a></h3>
          <p>${highlightedExcerpt}</p>
          <small><a href="${result.url}">${result.url}</a></small>
        </li>
      `;
    }).join('');
  }

  // Handle search input
  const searchInput = document.getElementById('search-input');
  let searchTimeout;

  // Check for query parameter (for direct links)
  const urlParams = new URLSearchParams(window.location.search);
  const initialQuery = urlParams.get('q');
  if (initialQuery) {
    searchInput.value = initialQuery;
    const results = search(initialQuery);
    displayResults(results, initialQuery);
  }

  searchInput.addEventListener('input', function() {
    clearTimeout(searchTimeout);
    const query = this.value.trim();

    searchTimeout = setTimeout(() => {
      const results = search(query);
      displayResults(results, query);
      
      // Update URL without reload
      const newUrl = query ? '/search.html?q=' + encodeURIComponent(query) : '/search.html';
      window.history.pushState({query: query}, '', newUrl);
    }, 300);
  });

  // Handle Enter key
  searchInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      const query = this.value.trim();
      const results = search(query);
      displayResults(results, query);
    }
  });
</script>

<style>
  #search-container {
    max-width: 900px;
    margin: 2rem auto;
    padding: 0 1rem;
  }

  #search-input {
    width: 100%;
    padding: 1rem 1.5rem;
    font-size: 1.1rem;
    border: 2px solid #ddd;
    border-radius: 6px;
    box-sizing: border-box;
    transition: border-color 0.2s;
  }

  #search-input:focus {
    outline: none;
    border-color: #0366d6;
    box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.1);
  }

  #results-info {
    margin: 1.5rem 0 1rem 0;
    color: #586069;
  }

  #results-info p {
    margin: 0;
  }

  #results-container {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  #results-container li {
    margin: 1.5rem 0;
    padding: 1.5rem;
    background: #f6f8fa;
    border-radius: 6px;
    border-left: 4px solid #0366d6;
    transition: box-shadow 0.2s;
  }

  #results-container li:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  #results-container li h3 {
    margin: 0 0 0.75rem 0;
    font-size: 1.2rem;
  }

  #results-container li h3 a {
    color: #0366d6;
    text-decoration: none;
  }

  #results-container li h3 a:hover {
    text-decoration: underline;
  }

  #results-container li p {
    margin: 0.75rem 0;
    color: #24292e;
    line-height: 1.6;
  }

  #results-container li small {
    display: block;
    margin-top: 0.5rem;
    color: #586069;
    font-size: 0.85rem;
  }

  #results-container li small a {
    color: #586069;
    text-decoration: none;
  }

  #results-container li small a:hover {
    color: #0366d6;
    text-decoration: underline;
  }

  mark {
    background-color: #ffd33d;
    padding: 0 2px;
    border-radius: 2px;
    font-weight: 500;
  }
</style>

